/*!
        Minimized for polarr_v001 2015-03-07 Production.
*/
var Music;Music=function(){function a(a){this.filename=a.filename,this.ctx,this.buf,this.fft,this.samples=128,this.setup=!1,this.gfx,this.wWidth,this.wHeight,this.height=300,this.visual=a.visual,this.beatHoldFrames=18,this.beatThreshold=80,this.beatCutoff=0,this.beatDecayRate=.95,this.framesSinceLastbeat=0}return a.prototype.init=function(){var a;try{return this.ctx=new(window.AudioContext||window.webkitAudioContext),this.loadFile()}catch(b){return a=b,alert("no web audio support")}},a.prototype.loadFile=function(){var a;return a=new XMLHttpRequest,a.open("GET",this.filename,!0),a.responseType="arraybuffer",a.onload=function(b){return function(){return b.ctx.decodeAudioData(a.response,function(a){return b.buf=a,b.play(),b.setupCanvas(),b.update()})}}(this),a.send()},a.prototype.play=function(){var a;return a=this.ctx.createBufferSource(),a.buffer=this.buf,this.fft=this.ctx.createAnalyser(),this.fft.fftSize=this.samples,a.connect(this.fft),this.fft.connect(this.ctx.destination),a.start(0),this.setup=!0},a.prototype.setupCanvas=function(){var a;return a=document.getElementById("canvas"),this.gfx=a.getContext("2d"),this.wWidth=document.body.clientWidth,this.wHeight=document.body.clientHeight,a.width=this.wWidth,a.height=this.height},a.prototype.update=function(){var a,b,c,d,e,f,g,h,i;if(requestAnimationFrame(this.update.bind(this)),this.setup){for(d=this.fft.frequencyBinCount,e=new Uint8Array(d),this.fft.getByteFrequencyData(e),a=this.getAverageVolume(e,d),g=this.detectBeat(a),this.gfx.clearRect(0,0,this.wWidth,this.height),this.gfx.fillStyle="rgb(20, 20, 20)",this.gfx.fillRect(0,0,this.wWidth,this.height),c=this.wWidth/(d+10),h=0,f=i=0;d>=0?d>=i:i>=d;f=d>=0?++i:--i)b=e[f]/2,this.gfx.fillStyle="rgb("+(b+100)+", 50, 50)",this.gfx.fillRect(h,this.height-b,c,b),h+=c+1;return b=a/2,this.gfx.fillStyle=g?"rgb(255, 255, 255)":"rgb("+(b+100)+", 50, 50)",this.gfx.fillRect(h,this.height-b,c,b)}},a.prototype.getAverageVolume=function(a,b){var c,d,e;for(d=0,c=e=0;b>=0?b>=e:e>=b;c=b>=0?++e:--e)d+=void 0===a[c]||0/0===a[c]?0:a[c];return d/b},a.prototype.detectBeat=function(a){return a>this.beatCutoff&&a>this.beatThreshold?(this.beatCutoff=1.1*a,this.framesSinceLastbeat=0,!0):(this.framesSinceLastbeat<=this.beatHoldFrames?this.framesSinceLastbeat+=1:(this.beatCutoff*=this.beatDecayRate,this.beatCutoff=Math.max(this.beatCutoff,this.beatThreshold)),!1)},a}();var Scene1;Scene1=function(){function a(a){this.scene=a.scene,this.composer=a.composer,this.camera=a.camera,this.particles=[]}return a.prototype.start=function(){var a;return this.makeParticles(),a=new THREE.ShaderPass(THREE.RGBShiftShader),a.uniforms.amount.value=0,a.renderToScreen=!0,this.composer.addPass(a),setInterval(this.update,1e3/30),this.angle=0,this.radius=10,this.count=0,this.color=0},a.prototype.update=function(){var a,b,c,d,e;if(this.count++,this.count%3===0){for(this.color+=.01,this.color>1&&(this.color=0),d=this.particles,e=[],b=0,c=d.length;c>b;b++)a=d[b],a.position.z+=30,this.angle+=45,this.angle>360&&(this.angle=0),a.material.color.setHSL(this.color,1,.7),e.push(a.position.z>1e3?a.position.z-=2e3:void 0);return e}},a.prototype.makeParticles=function(){var a,b,c,d,e,f;for(e=f=-5e3;5e3>=f;e=f+=20)a=new THREE.SpriteMaterial({color:16777215}),c=THREE.ImageUtils.loadTexture("textures/spark.png"),d=new THREE.SpriteMaterial({map:c,useScreenCoordinates:!1,color:16777215}),b=new THREE.Particle(d),b.material.color.setHSL(1,.7,.6),b.position.x=2e3*Math.random()-1e3,b.position.y=2e3*Math.random()-1e3,b.position.z=e,b.scale.x=b.scale.y=80,this.scene.add(b),this.particles.push(b);return{particleRender:function(a){return a.beginPath(),a.arc(0,0,1,0,2*Math.PI,!0),a.fill()},updateParticles:function(){var a,c,d,e;for(e=[],a=c=0,d=this.particles.length;d>=0?d>c:c>d;a=d>=0?++c:--c)b=this.particles[a],b.position.z+=.1,e.push(b.position.z>1e3?b.position.z-=2e3:void 0);return e}}},a}();var AMOUNTX,AMOUNTY,PI2,SEPARATION,Scene2;SEPARATION=100,AMOUNTX=50,AMOUNTY=50,PI2=2*Math.PI,Scene2=function(){function a(a){this.scene=a.scene,this.composer=a.composer,this.camera=a.camera,this.camera.position.y=1e3,this.camera.position.z=1e3,this.particles=new Array,this.count=0}return a.prototype.start=function(){var a,b,c,d,e,f,g,h;for(a=new THREE.ShaderPass(THREE.RGBShiftShader),a.uniforms.amount.value=.0015,a.renderToScreen=!0,this.composer.addPass(a),e=new THREE.SpriteMaterial({color:16777215}),b=0,h=[],c=g=0;AMOUNTX>=0?AMOUNTX>g:g>AMOUNTX;c=AMOUNTX>=0?++g:--g)h.push(function(){var a,g;for(g=[],d=a=0;AMOUNTY>=0?AMOUNTY>a:a>AMOUNTY;d=AMOUNTY>=0?++a:--a)f=this.particles[b++]=new THREE.Sprite(e),f.position.x=c*SEPARATION-AMOUNTX*SEPARATION/2,f.position.z=d*SEPARATION-AMOUNTY*SEPARATION/2,g.push(this.scene.add(f));return g}.call(this));return h},a.prototype.update=function(){var a,b,c,d,e,f;for(a=0,b=e=0;AMOUNTX>=0?AMOUNTX>e:e>AMOUNTX;b=AMOUNTX>=0?++e:--e)for(c=f=0;AMOUNTY>=0?AMOUNTY>f:f>AMOUNTY;c=AMOUNTY>=0?++f:--f)d=this.particles[a++],d.position.y=50*Math.sin(.3*(b+this.count))+50*Math.sin(.5*(c+this.count)),d.scale.x=d.scale.y=4*(Math.sin(.3*(b+this.count))+1)+4*(Math.sin(.5*(c+this.count))+1);return this.count+=.1},a}();var Visual;Visual=function(){function a(a){this.music=a.music,this.container=document.getElementById("container"),this.camera=new THREE.PerspectiveCamera(80,window.innerWidth/window.innerHeight,1,4e3),this.camera.position.z=1e3,this.scene=new THREE.Scene,this.renderer=new THREE.WebGLRenderer,this.renderer.setSize(window.innerWidth,window.innerHeight),this.composer=new THREE.EffectComposer(this.renderer),this.scene2=new Scene2({scene:this.scene,composer:this.composer,camera:this.camera})}return a.prototype.init=function(){return this.container.appendChild(this.renderer.domElement),this.composer.addPass(new THREE.RenderPass(this.scene,this.camera)),this.scene2.start()},a.prototype.render=function(){return requestAnimationFrame(this.render.bind(this)),this.scene2.update(this.music.getBarWidth()),this.composer.render()},a}();var Visualizer;Visualizer=function(){function a(){this.music=new Music({filename:"numb.mp3"}),this.visual=new Visual({music:this.music})}return a.prototype.start=function(){return this.music.init(),this.visual.init(),this.render()},a.prototype.render=function(){return this.music.g,this.visual.render()},a}();